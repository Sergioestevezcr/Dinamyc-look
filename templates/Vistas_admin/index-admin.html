<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Título de la pestaña -->
    <title>Dinamyc Look - Admin</title>

    <!-- Estilos CSS de la página -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_admin/style_index_admin.css') }}">

    <!-- Fuente de iconos Boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Fuente de iconos FontAwesome -->
    <script src="https://kit.fontawesome.com/be457a772f.js" crossorigin="anonymous"></script>

    <!-- Libreria de graficas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180"
        href="{{ url_for('static', filename='imagenes/favicons/apple-touch-icon.ico') }}">
    <link rel="icon" type="image/png" sizes="32x32"
        href="{{ url_for('static', filename='imagenes/favicons/favicon-32x32.ico') }}">
    <link rel="icon" type="image/png" sizes="16x16"
        href="{{ url_for('static', filename='imagenes/favicons/favicon-16x16.ico') }}">
    <link rel="manifest" href="{{ url_for('static', filename='imagenes/favicons/site.webmanifest') }}">
    <link rel="mask-icon" href="{{ url_for('static', filename='imagenes/favicons/safari-pinned-tab.svg') }}"
        color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</head>

<body>
    <!-- Mensajes flash (notificaciones temporales desde Flask) -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert {{ category }}">
        {{ message }}
        <button class="alert-close">&times;</button>
        <div class="alert-progress"></div>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    <!-- Contenedor principal -->
    <div class="container">

        <!-- Barra lateral de navegación -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="company-name">Dinamyc Look</h2>
                <button class="close-btn" id="close_btn">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li><a href="{{ url_for('admin_bp.index') }}" class="active"><i
                                class='bx bxs-dashboard'></i><span>Dashboard</span></a></li>
                    <li><a href="{{ url_for('admin_bp.usuarios') }}"><i
                                class="fa-solid fa-user"></i><span>Clientes</span></a>
                    </li>
                    <li><a href="{{ url_for('admin_bp.admin') }}">
                            <i class="fa-solid fa-user-gear"></i><span>Admin</span></a>
                    </li>
                    <li><a href="{{ url_for('admin_bp.pedidos_view') }}"><i
                                class='bx bxs-dollar-circle'></i><span>Pedidos</span></a>
                    </li>
                    <li><a href="{{ url_for('admin_bp.productos') }}"><i
                                class="fas fa-tags"></i><span>Productos</span></a></li>
                    <li><a href="{{ url_for('admin_bp.promociones') }}"><i
                                class="fas fa-percent"></i><span>Promociones</span></a></li>
                    <li><a href="{{ url_for('admin_bp.reportes') }}"><i
                                class="fa-solid fa-receipt"></i><span>Reportes</span></a>
                    </li>
                    <li><a href="{{ url_for('admin_bp.configuracion') }}"><i
                                class="fa-solid fa-gear"></i><span>Configuración</span></a></li>
                    <li><a href="{{ url_for('auth_bp.logout') }}"><i class='bx bx-log-out'></i><span>Cerrar
                                sesión</span></a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Contenido principal de la página -->
        <main class="main-content">
            <!-- Encabezado principal con botón de menú para móvil -->
            <header class="main-header">
                <button class="menu-toggle" id="open_btn">
                    <i class='bx bx-menu'></i>
                </button>
                <h1>Dashboard</h1>
            </header>

            <!-- Tarjetas de estadísticas -->
            <section class="dash1">
                <div class="stats-cards">
                    <!-- Tarjeta 1 -->
                    <div class="stat-card imp">
                        <div class="stat-icon"><i class="fas fa-shopping-bag"></i></div>
                        <div class="stat-info">
                            <h3>pedidos Totales</h3>
                            <div class="stat-value">{{ pedidos }}</div>
                        </div>
                    </div>

                    <!-- Tarjeta 2 -->
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                        <div class="stat-info">
                            <h3>Ingresos Totales</h3>
                            <div class="stat-value">${{ "{:,}".format(ingresos).replace(",", ".") }}</div>
                        </div>
                    </div>

                    <!-- Tarjeta 3 -->
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fa-solid fa-tag"></i></div>
                        <div class="stat-info">
                            <h3>Productos Vendidos</h3>
                            <div class="stat-value">{{ productosT }}</div>
                        </div>
                    </div>
                    <!-- Tarjeta 4 -->
                    <div class="stat-card imp">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3>Usuarios</h3>
                            <div class="stat-value">{{ usuariosT }}</div>
                        </div>
                    </div>
                </div>
                <div class="graf-up">
                    <div class="chart-box">
                        <h3>Usuarios y Productos por Mes</h3>
                        <canvas id="chartUsuariosProductos"></canvas>
                    </div>
                </div>
            </section>


            <section class="chart-section">
                <div class="charts-container">
                    <!-- Gráfico de línea -->
                    <div class="chart-box">
                        <h3>Ingresos por Mes</h3>
                        <canvas id="chartIngresos"></canvas>
                    </div>

                    <!-- Gráfico de barras -->
                    <div class="chart-box">
                        <h3>pedidos por Mes</h3>
                        <canvas id="chartpedidos"></canvas>
                    </div>
                </div>
            </section>

            <section class="tablas-container">
                <div class="recent-orders">
                    <div class="section-header">
                        <h2>Productos Más Vendidos</h2>
                    </div>

                    <!-- Contenedor de la tabla -->
                    <div class="table-container">
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>Nombre producto</th>
                                    <th>Marca</th>
                                    <th>cantidad</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for vendido in vendidos %}
                                <tr>
                                    <td>{{ vendido.0 }}</td>
                                    <td>{{ vendido.1 }}</td>
                                    <td>{{ vendido.2 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="recent-orders">
                    <div class="section-header">
                        <h2>Productos por Acabarse</h2>
                    </div>

                    <!-- Contenedor de la tabla -->
                    <div class="table-container">
                        <table class="orders-table2">
                            <thead>
                                <tr>
                                    <th>Nombre producto</th>
                                    <th>cantidad</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for acabado in acabados %}
                                <tr>
                                    <td>{{ acabado.0 }}</td>
                                    <td>{{ acabado.1 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Pie de página -->
    <footer class="footer">
        <p>&copy; 2024 DinamycLook® | Todos los derechos reservados | BY: Laura vargas , Sergio Soriano. </p>vargas ,
        Sergio Soriano </p>
    </footer>

    <!-- Script de JavaScript-->
    <script src="{{ url_for('static', filename='js/script_sidebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script_alert.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script_paginacion_tabla.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/script_sidebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script_alert.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script_paginacion_tabla.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Ejecutar en paralelo las peticiones al backend
            Promise.all([
                fetch("{{ url_for('admin_bp.pedidos_por_mes') }}").then(r => r.json()),
                fetch("{{ url_for('admin_bp.usuarios_productos_por_mes') }}").then(r => r.json())
            ])
                .then(([pedidosData, usuariosProductosData]) => {

                    // ==============================
                    // 1️⃣ GRÁFICO DE INGRESOS POR MES
                    // ==============================
                    const ctxIngresos = document.getElementById('chartIngresos').getContext('2d');
                    new Chart(ctxIngresos, {
                        type: 'line',
                        data: {
                            labels: pedidosData.labels,
                            datasets: [{
                                label: 'Ingresos por mes',
                                data: pedidosData.dataIngresos,
                                fill: true,
                                borderColor: 'rgba(138, 42, 71, 1)',
                                backgroundColor: 'rgba(138, 42, 71, 0.2)',
                                tension: 0.4,
                                pointRadius: 5,
                                pointHoverRadius: 7
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    backgroundColor: '#fff',
                                    titleColor: '#C1416D',
                                    bodyColor: '#333',
                                    borderColor: '#C1416D',
                                    borderWidth: 1
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'Ingresos ($)', font: { size: 14 } },
                                    ticks: { color: '#C1416D' },
                                    grid: { color: 'rgba(116, 39, 62, 0.1)' }
                                },
                                x: {
                                    ticks: { color: '#C1416D' },
                                    grid: { display: false }
                                }
                            }
                        }
                    });

                    // ==============================
                    // 2️⃣ GRÁFICO DE pedidos POR MES
                    // ==============================
                    const ctxpedidos = document.getElementById('chartpedidos').getContext('2d');
                    new Chart(ctxpedidos, {
                        type: 'bar',
                        data: {
                            labels: pedidosData.labels,
                            datasets: [{
                                label: 'pedidos por mes',
                                data: pedidosData.datapedidos,
                                backgroundColor: 'rgba(138, 42, 71, 0.7)',
                                borderRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    backgroundColor: '#fff',
                                    titleColor: '#C1416D',
                                    bodyColor: '#333',
                                    borderColor: '#C1416D',
                                    borderWidth: 1
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'pedidos', font: { size: 14 } },
                                    ticks: { color: '#C1416D' },
                                    grid: { color: 'rgba(193, 65, 109, 0.1)' }
                                },
                                x: {
                                    ticks: { color: '#C1416D' },
                                    grid: { display: false }
                                }
                            }
                        }
                    });

                    // ================================================
                    // 3️⃣ GRÁFICO DE USUARIOS NUEVOS Y PRODUCTOS VENDIDOS
                    // ================================================
                    const ctxUP = document.getElementById('chartUsuariosProductos').getContext('2d');
                    new Chart(ctxUP, {
                        type: 'bar',
                        data: {
                            labels: usuariosProductosData.labels,
                            datasets: [
                                {
                                    label: 'Usuarios Nuevos',
                                    data: usuariosProductosData.usuarios,
                                    backgroundColor: 'rgba(237, 180, 205, 0.6)',
                                    borderColor: 'rgba(212, 96, 141, 1)',
                                    borderWidth: 1,
                                    yAxisID: 'y1'
                                },
                                {
                                    label: 'Productos Vendidos',
                                    data: usuariosProductosData.productos,
                                    backgroundColor: 'rgba(166, 48, 85, 0.6)',
                                    borderColor: 'rgba(116, 39, 62, 1)',
                                    borderWidth: 1,
                                    yAxisID: 'y2'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            interaction: { mode: 'index', intersect: false },
                            stacked: false,
                            plugins: {
                                legend: {
                                    position: 'bottom', //  coloca la leyenda debajo
                                    align: 'center',    //  centra horizontalmente
                                    fullSize: true,
                                    labels: {
                                        boxWidth: 20,   // ancho del cuadrito de color
                                        boxHeight: 8,
                                        padding: 10,    // espacio entre los textos
                                        usePointStyle: true, // opcional, redondea los íconos
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: '#fff',
                                    titleColor: '#C1416D',
                                    bodyColor: '#333',
                                    borderColor: '#C1416D',
                                    borderWidth: 1
                                }
                            },
                            scales: {
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Usuarios Nuevos' },
                                    grid: { drawOnChartArea: false }
                                },
                                y2: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'Productos Vendidos' },
                                    grid: { drawOnChartArea: false }
                                },
                                x: { grid: { display: false } }
                            }
                        }
                    });


                })
                .catch(err => console.error("Error cargando datos de gráficas:", err));
        });
    </script>

</body>

</html>